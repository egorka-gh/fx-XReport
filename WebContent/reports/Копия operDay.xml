<element-set>
  <element name="rpbody">
    <sql>
      <![CDATA[    
SELECT
  CONCAT_WS(' ','Выручка кассы №', pos.kkm_number) kkm,
  :pkasir kasir,
  pos.number term,
  sc.`date` AS shiftdate,
  login.user_name AS cashiername,
  ods.oper_day operday,
  SUM(IF(srp.is_local = 1, srp.sale_ukm - srp.return_ukm, 0)) AS sum,
  CONCAT('                         ',xrep.num_to_text(SUM(IF(srp.is_local = 1, srp.sale_ukm - srp.return_ukm, 0)))) spellsum
FROM trm_out_shift_result sr
  INNER JOIN ukmserver.trm_out_shift_open so ON so.cash_id = sr.cash_id AND so.id = sr.id
  INNER JOIN ukmserver.trm_out_shift_close sc ON sc.cash_id = so.cash_id AND sc.id = so.id
  INNER JOIN ukmserver.trm_out_login login ON login.cash_id = so.cash_id AND login.id = sc.login
  INNER JOIN ukmserver.trm_in_pos pos ON pos.cash_id = sr.cash_id
  INNER JOIN ukmserver.local_oper_day_shift ods ON ods.store_id = pos.store_id AND ods.cash_id = sr.cash_id AND ods.shift_id = sr.id
  LEFT JOIN ukmserver.trm_line_oper_day od ON od.store_id = pos.store_id AND od.date = ods.oper_day AND od.deleted = 0
  LEFT JOIN ukmserver.trm_out_shift_result_payments srp ON srp.cash_id = sr.cash_id AND srp.id = sr.id AND srp.is_cash = 1
WHERE pos.store_id = 13001 AND ods.oper_day = STR_TO_DATE( :pdate , '%Y-%m-%d')
GROUP BY sr.cash_id, sr.id
ORDER BY pos.number
	]]>
    </sql>
  </element>

</element-set>
